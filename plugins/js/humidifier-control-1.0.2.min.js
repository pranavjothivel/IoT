var deviceID = "47004c001051373331333230";
var accessToken = "6f3236f2330f9d2cf18c2c986897b99d6c08cc30";
var status_control_url = "https://api.particle.io/v1/devices/"+deviceID+"/control";
var active_control_url = "https://api.particle.io/v1/devices/"+deviceID+"/active";
var humidity_url = "https://api.particle.io/v1/devices/"+deviceID+"/humidity";
var status_url = "https://api.particle.io/v1/devices/"+deviceID+"/status";
var active_value_url = "https://api.particle.io/v1/devices/"+deviceID+"/ActiveValue";

function SetStatusCallback(data, status) {
    if (data.return_value == 20) {
        alert("Status has been set to ON");
        CurrentStatusRetriever();
    }
    else if (data.return_value == 10) {
        alert("Status has been set to OFF");
        CurrentStatusRetriever();
    }
}

function CurrentStatusCallback(data, status) {
    if (status == "success") {
        
        setInterval(CurrentStatusRetriever, 45000);
        
        if (data.result) {
            document.getElementById("CurrentStatus").innerHTML="On";
        }
        else if (data.result === false ) {
            document.getElementById("CurrentStatus").innerHTML="Off";
        }
    }
}

function CurrentHumidityCallback(data, status) {
    if (status == "success") {
        var humidity = data.result;
        document.getElementById("CurrentHumidity").innerHTML=humidity;
        
        setInterval(CurrentHumidityRetriever, 45000);
    }
}

function ActiveControlCallback(data, status) {
    if (status == "success") {
        if (data.return_value == 45){
            alert("Run Point Humidity has been set");
        }
    }
}

function CurrentRunPointCallback(data, status) {
    if (status == "success") {
        
        setInterval(CurrentRunPoint, 45000);
        
        var RunPoint = data.result;
        document.getElementById("SetRunPoint").innerHTML=RunPoint;
    }
}

function CurrentRunPoint() {
    $.get(active_value_url, {access_token: accessToken}, CurrentRunPointCallback);
}

function toggleOn() {
    $.post(status_control_url, {params: "on", access_token: accessToken}, SetStatusCallback);
}

function toggleOff() {
    $.post(status_control_url, {params: "off", access_token: accessToken}, SetStatusCallback);
}

function sendRunPoint() {
    RunPoint = $("#RunPointValue").val();
    
    if (RunPoint <= 100 || RunPoint >= 0) {
        $.post(active_control_url, {params: RunPoint, access_token: accessToken}, ActiveControlCallback);
        
        CurrentRunPoint();
    }
    else {
        alert('Run Point is not between the values of "0 - 100". Please change the Run Point and resubmit.');
    }
  
    
}

function CurrentStatusRetriever() {
    $.get(status_url, {access_token: accessToken}, CurrentStatusCallback);
}

function CurrentHumidityRetriever() {
    $.get(humidity_url, {access_token: accessToken}, CurrentHumidityCallback);
}




CurrentStatusRetriever();
CurrentRunPoint();
CurrentHumidityRetriever();